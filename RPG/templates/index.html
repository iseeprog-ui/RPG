<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Eternal Shards • Ultimate Fusion</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
  <style>
    canvas { image-rendering: pixelated; }
    #tooltip { position: absolute; background: rgba(0,0,20,0.9); padding: 6px 10px; border-radius: 8px; border: 1px solid #3a7ca5; pointer-events: none; font-size: 12px; display: none; z-index: 100; }
    .enemy-hp { position: absolute; height: 5px; background: #c0392b; transition: width 0.2s; border-radius: 3px; }
  </style>
</head>
<body>
  <div id="game-root">
    <div class="top-bar glass">
      <div class="title">
        <span class="title-main">Eternal Shards</span>
        <span class="title-sub">Ultimate Fusion RPG</span>
      </div>
      <div class="top-bar-stats">
        <div class="bar-group">
          <span class="bar-label">HP</span>
          <div class="bar hp"><div class="fill" id="hp-bar"></div></div>
          <span class="bar-value" id="hp-text"></span>
        </div>
        <div class="bar-group">
          <span class="bar-label">MP</span>
          <div class="bar mp"><div class="fill" id="mp-bar"></div></div>
          <span class="bar-value" id="mp-text"></span>
        </div>
        <div class="bar-group">
          <span class="bar-label">XP</span>
          <div class="bar xp"><div class="fill" id="xp-bar"></div></div>
          <span class="bar-value" id="xp-text"></span>
        </div>
      </div>
      <div class="top-bar-meta">
        <div id="meta-info"></div>
        <div class="meta-buttons">
          <button id="save-btn" class="meta-btn">Сохранить</button>
          <button id="load-btn" class="meta-btn">Загрузить</button>
          <button id="skillTreeBtn" class="meta-btn">Древо</button>
        </div>
      </div>
    </div>

    <div class="layout">
      <div class="left-panel">
        <div class="canvas-wrapper glass">
          <canvas id="game-canvas" width="960" height="540"></canvas>
          <div id="portal-hint" class="portal-hint hidden">E - войти в портал</div>
        </div>
        <div class="controls glass">
          <div><strong>Управление</strong></div>
          <div>WASD / ↑↓←→ — движение</div>
          <div>Пробел — уворот</div>
          <div>ЛКМ — атака</div>
          <div>ПКМ — ультимейт</div>
          <div>E — портал / взаимодействие</div>
        </div>
        <div class="log glass" id="log"></div>
      </div>
      <div class="right-panel">
        <div class="tabs">
          <button class="tab active" data-tab="stats">Статы</button>
          <button class="tab" data-tab="inventory">Сумка</button>
          <button class="tab" data-tab="quests">Квесты</button>
        </div>
        <div class="tab-content" id="tab-stats">
          <div class="section glass">
            <h2>Персонаж</h2>
            <div id="char-summary"></div>
          </div>
          <div class="section glass">
            <h2>Характеристики</h2>
            <ul class="stats-list" id="stats-list"></ul>
          </div>
        </div>
        <div class="tab-content hidden" id="tab-inventory">
          <div class="section glass">
            <h2>Сумка (<span id="inv-count">0</span>/27)</h2>
            <div id="invSlots"></div>
          </div>
          <div class="section glass">
            <h2>Экипировка</h2>
            <div class="equip-row">
              <div>
                Оружие:
                <div id="weaponSlot" class="slot equip-slot" data-equip="weapon"></div>
              </div>
              <div>
                Броня:
                <div id="armorSlot" class="slot equip-slot" data-equip="armor"></div>
              </div>
            </div>
          </div>
        </div>
        <div class="tab-content hidden" id="tab-quests">
          <div class="section glass">
            <h2>Квесты</h2>
            <ul class="quest-list" id="quest-list"></ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Экраны -->
    <div id="start-screen" class="overlay visible">
      <div class="overlay-panel glass">
        <h1>Выбор героя</h1>
        <p>Эльфы • Орки • Люди • Демоны</p>
        <div class="overlay-row">
          <div class="overlay-col">
            <h2>Раса</h2>
            <select id="race-select">
              <option value="human">Человек</option>
              <option value="elf">Эльф</option>
              <option value="orc">Орк</option>
              <option value="demon">Демон</option>
            </select>
          </div>
          <div class="overlay-col">
            <h2>Класс</h2>
            <div class="class-grid" id="class-grid">
              <button data-class="ranger">Стрелок</button>
              <button data-class="mage">Маг</button>
              <button data-class="warrior">Воин</button>
              <button data-class="berserker">Берсерк</button>
              <button data-class="assassin">Ассасин</button>
            </div>
          </div>
        </div>
        <button id="start-btn" class="primary">Начать</button>
      </div>
    </div>

    <div id="spec-screen" class="overlay hidden">
      <div class="overlay-panel glass">
        <h1>Специализация</h1>
        <p>Выберите путь мастера</p>
        <div id="spec-options" class="spec-grid"></div>
        <button id="spec-skip-btn" class="meta-btn">Пропустить</button>
      </div>
    </div>

    <div id="death-screen" class="overlay hidden">
      <div class="overlay-panel glass">
        <h1>Вы пали...</h1>
        <button id="restart-btn" class="primary">Возродиться</button>
      </div>
    </div>

    <div id="skillTree" class="overlay hidden">
      <div class="overlay-panel glass" style="max-width:600px;">
        <h2>Древо умений (<span id="skillPoints">0</span> очков)</h2>
        <div class="skill-tree-grid">
          <div class="node" data-skill="powerStrike">Мощный удар</div>
          <div class="node" data-skill="multiShot">Мульти-выстрел</div>
          <div class="node" data-skill="fireball">Огненный шар</div>
          <div class="node" data-skill="shadowStep">Шаг в тени</div>
          <div class="node" data-skill="rage">Ярость</div>
        </div>
        <button id="closeSkillTree" class="meta-btn">Закрыть</button>
      </div>
    </div>

    <div id="tooltip"></div>
  </div>

  <script src="{{ url_for('static', filename='main.js') }}"></script>
</body>
</html>
